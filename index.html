<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anu â€” Focus Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #16161f;
            --bg-hover: #1c1c28;
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #475569;
            --border: rgba(255,255,255,0.06);
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 24px;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 48px;
        }
        
        .greeting h1 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .greeting p {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        .defense-countdown {
            text-align: right;
        }
        
        .defense-countdown .label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 4px;
        }
        
        .defense-countdown .time {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .defense-countdown .subtext {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        /* Quote */
        .quote-section {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1));
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px 32px;
            margin-bottom: 48px;
            position: relative;
            overflow: hidden;
        }
        
        .quote-section::before {
            content: '"';
            position: absolute;
            top: -20px;
            left: 20px;
            font-size: 8rem;
            color: rgba(99, 102, 241, 0.1);
            font-family: Georgia, serif;
        }
        
        .quote {
            font-size: 1.25rem;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }
        
        .quote-author {
            margin-top: 8px;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        /* Stats Row */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 48px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .stat-value.accent { color: var(--accent); }
        .stat-value.success { color: var(--success); }
        .stat-value.warning { color: var(--warning); }
        
        .stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
        
        @media (max-width: 900px) {
            .main-grid { grid-template-columns: 1fr; }
            .stats-row { grid-template-columns: repeat(2, 1fr); }
        }
        
        /* Section */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title .icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .section.work .section-title .icon { background: rgba(99, 102, 241, 0.2); }
        .section.personal .section-title .icon { background: rgba(245, 158, 11, 0.2); }
        
        .section-progress {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        /* Subsection */
        .subsection {
            margin-bottom: 20px;
        }
        
        .subsection:last-child { margin-bottom: 0; }
        
        .subsection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }
        
        .subsection-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .subsection-count {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        /* Add Task */
        .add-task {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .add-task input {
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 0.875rem;
            font-family: inherit;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        .add-task .task-input { flex: 1; }
        
        .add-task .date-input {
            width: 130px;
            color-scheme: dark;
        }
        
        .add-task input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }
        
        .add-task input::placeholder { color: var(--text-muted); }
        
        .add-task button {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            background: var(--accent);
            color: white;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
        }
        
        .add-task button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--accent-glow);
        }
        
        /* Edit Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
        }
        .modal h3 {
            margin-bottom: 16px;
            font-size: 1.1rem;
        }
        .modal input {
            width: 100%;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 0.9rem;
        }
        .modal input[type="date"] { color-scheme: dark; }
        .modal-buttons {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 16px;
        }
        .modal-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
        }
        .modal-buttons .cancel {
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }
        .modal-buttons .save {
            background: var(--accent);
            color: white;
        }
        
        /* Tasks */
        .task-list { list-style: none; }
        
        .task {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 4px;
            transition: background 0.15s;
            cursor: pointer;
        }
        
        .task:hover { background: var(--bg-hover); }
        
        .task.done { opacity: 0.5; }
        .task.done .task-text { text-decoration: line-through; }
        
        .task input[type="checkbox"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--text-muted);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
            flex-shrink: 0;
        }
        
        .task input[type="checkbox"]:checked {
            background: var(--success);
            border-color: var(--success);
        }
        
        .task input[type="checkbox"]:checked::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .task-text {
            flex: 1;
            font-size: 0.9rem;
        }
        
        .task .edit, .task .delete {
            opacity: 0.3;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            padding: 4px 8px;
            transition: opacity 0.15s;
        }
        
        .task .edit { color: var(--text-secondary); }
        .task .delete { color: var(--danger); }
        
        .task:hover .edit, .task:hover .delete { opacity: 1; }
        
        @media (max-width: 768px) {
            .task .edit, .task .delete { opacity: 0.6; }
        }
        
        .task .due-date {
            margin-left: 8px;
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 4px;
            background: rgba(99, 102, 241, 0.2);
            color: var(--accent);
        }
        
        .task.overdue .due-date {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }
        
        /* Progress Bar */
        .progress-bar-container {
            margin-top: 16px;
            background: var(--bg-secondary);
            border-radius: 8px;
            height: 6px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #a855f7);
            border-radius: 8px;
            transition: width 0.4s ease;
        }
        
        /* Add Category Button */
        .add-category {
            margin-top: 16px;
            text-align: center;
        }
        
        .add-category button {
            background: transparent;
            border: 1px dashed var(--border);
            color: var(--text-muted);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.15s;
        }
        
        .add-category button:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 32px;
            color: var(--text-muted);
        }
        
        /* Streak Badge */
        .streak-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="greeting">
                <h1 id="greeting">Good morning, Anu</h1>
                <p id="date-display"></p>
            </div>
            <div class="defense-countdown">
                <div class="label">Exit Seminar</div>
                <div class="time" id="countdown">--</div>
                <div class="subtext">days remaining</div>
            </div>
        </header>
        
        <div class="quote-section">
            <p class="quote" id="quote">The only way to do great work is to love what you do.</p>
            <p class="quote-author" id="quote-author">â€” Steve Jobs</p>
        </div>
        
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-value accent" id="total-tasks">0</div>
                <div class="stat-label">Total Tasks</div>
            </div>
            <div class="stat-card">
                <div class="stat-value success" id="completed-tasks">0</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value warning" id="pending-tasks">0</div>
                <div class="stat-label">In Progress</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completion-rate">0%</div>
                <div class="stat-label">Completion Rate</div>
            </div>
        </div>
        
        <div class="main-grid">
            <div class="section work">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="icon">ðŸ’¼</span>
                        Work
                    </h2>
                    <span class="section-progress" id="work-progress">0/0</span>
                </div>
                <div id="work-subsections"></div>
                <div class="add-category">
                    <button onclick="addSubsection('work')">+ Add Category</button>
                </div>
            </div>
            
            <div class="section personal">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="icon">âœ¨</span>
                        Personal
                    </h2>
                    <span class="section-progress" id="personal-progress">0/0</span>
                </div>
                <div id="personal-subsections"></div>
                <div class="add-category">
                    <button onclick="addSubsection('personal')">+ Add Category</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <h3>Edit Task</h3>
            <input type="text" id="editText" placeholder="Task description">
            <input type="date" id="editDate">
            <div class="modal-buttons">
                <button class="cancel" onclick="closeModal()">Cancel</button>
                <button class="save" onclick="saveEdit()">Save</button>
            </div>
        </div>
    </div>

    <script>
        const DEFENSE_DATE = new Date('2026-02-28T10:00:00');
        let editingTask = null;
        
        const quotes = [
            { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
            { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
            { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
            { text: "It does not matter how slowly you go as long as you do not stop.", author: "Confucius" },
            { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { text: "The PhD is a marathon, not a sprint. Pace yourself.", author: "Academia Wisdom" },
            { text: "Done is better than perfect.", author: "Sheryl Sandberg" },
            { text: "Small daily improvements are the key to staggering long-term results.", author: "Robin Sharma" },
            { text: "The dissertation is not your life's work. It's your ticket to your life's work.", author: "Anonymous" },
            { text: "You don't have to be great to start, but you have to start to be great.", author: "Zig Ziglar" }
        ];
        
        const defaultData = {
            work: {
                thesis: { name: "ðŸ“š Exit Seminar", tasks: [] },
                startup: { name: "ðŸš€ NeoVariant", tasks: [] },
                jobs: { name: "ðŸŽ¯ Job Search", tasks: [] }
            },
            personal: {
                life: { name: "ðŸ  Life", tasks: [] },
                health: { name: "ðŸ’ª Health", tasks: [] }
            }
        };
        
        let data = JSON.parse(localStorage.getItem('anu-dashboard-v2') || 'null') || defaultData;
        
        // Fetch remote tasks from Kuku and merge
        async function syncRemoteTasks() {
            try {
                const res = await fetch('tasks.json?t=' + Date.now());
                if (!res.ok) return;
                const remote = await res.json();
                
                // Merge remote into local
                ['work', 'personal'].forEach(section => {
                    if (!remote[section]) return;
                    Object.entries(remote[section]).forEach(([key, sub]) => {
                        if (!data[section][key]) {
                            // New category from Kuku
                            data[section][key] = sub;
                        } else {
                            // Merge tasks - add remote tasks not in local
                            const localTexts = new Set(data[section][key].tasks.map(t => t.text));
                            sub.tasks.forEach(t => {
                                if (!localTexts.has(t.text)) {
                                    data[section][key].tasks.unshift(t);
                                }
                            });
                        }
                    });
                });
                save();
                render();
            } catch (e) {
                console.log('No remote sync available');
            }
        }
        
        function save() {
            localStorage.setItem('anu-dashboard-v2', JSON.stringify(data));
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function formatDue(dateStr) {
            const due = new Date(dateStr + 'T23:59:59');
            const now = new Date();
            const diff = Math.ceil((due - now) / (1000 * 60 * 60 * 24));
            
            if (diff < 0) return 'overdue';
            if (diff === 0) return 'today';
            if (diff === 1) return 'tomorrow';
            if (diff <= 7) {
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                return days[due.getDay()];
            }
            return due.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }
        
        function updateGreeting() {
            const hour = new Date().getHours();
            let greeting = 'Good evening';
            if (hour < 12) greeting = 'Good morning';
            else if (hour < 17) greeting = 'Good afternoon';
            
            document.getElementById('greeting').textContent = `${greeting}, Anu`;
            
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('date-display').textContent = new Date().toLocaleDateString('en-US', options);
        }
        
        function updateCountdown() {
            const now = new Date();
            const diff = DEFENSE_DATE - now;
            const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
            
            document.getElementById('countdown').textContent = days > 0 ? days : 'ðŸŽ‰';
        }
        
        function updateQuote() {
            const today = new Date().toDateString();
            const storedDate = localStorage.getItem('quote-date');
            let quoteIndex = parseInt(localStorage.getItem('quote-index') || '0');
            
            if (storedDate !== today) {
                quoteIndex = Math.floor(Math.random() * quotes.length);
                localStorage.setItem('quote-date', today);
                localStorage.setItem('quote-index', quoteIndex);
            }
            
            const quote = quotes[quoteIndex];
            document.getElementById('quote').textContent = quote.text;
            document.getElementById('quote-author').textContent = `â€” ${quote.author}`;
        }
        
        function updateStats() {
            let total = 0, completed = 0;
            
            ['work', 'personal'].forEach(section => {
                Object.values(data[section]).forEach(sub => {
                    total += sub.tasks.length;
                    completed += sub.tasks.filter(t => t.done).length;
                });
            });
            
            const pending = total - completed;
            const rate = total ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('total-tasks').textContent = total;
            document.getElementById('completed-tasks').textContent = completed;
            document.getElementById('pending-tasks').textContent = pending;
            document.getElementById('completion-rate').textContent = rate + '%';
        }
        
        function updateSectionProgress(section) {
            let total = 0, completed = 0;
            Object.values(data[section]).forEach(sub => {
                total += sub.tasks.length;
                completed += sub.tasks.filter(t => t.done).length;
            });
            document.getElementById(`${section}-progress`).textContent = `${completed}/${total}`;
        }
        
        function render() {
            ['work', 'personal'].forEach(section => {
                const container = document.getElementById(`${section}-subsections`);
                const subs = data[section];
                
                if (Object.keys(subs).length === 0) {
                    container.innerHTML = '<div class="empty-state">No categories yet. Add one to get started!</div>';
                    return;
                }
                
                container.innerHTML = Object.entries(subs).map(([key, sub]) => {
                    const done = sub.tasks.filter(t => t.done).length;
                    const total = sub.tasks.length;
                    const pct = total ? (done / total * 100) : 0;
                    
                    return `
                        <div class="subsection" data-key="${key}">
                            <div class="subsection-header">
                                <span class="subsection-title">${escapeHtml(sub.name)}</span>
                                <span class="subsection-count">${done}/${total}</span>
                            </div>
                            <div class="add-task">
                                <input type="text" placeholder="Add a task..." class="task-input"
                                       onkeypress="if(event.key==='Enter')addTaskWithDate('${section}','${key}',this)">
                                <input type="date" class="date-input" title="Due date (optional)">
                                <button onclick="addTaskWithDate('${section}','${key}',this.parentElement.querySelector('.task-input'))">+</button>
                            </div>
                            <ul class="task-list">
                                ${sub.tasks.map((task, i) => `
                                    <li class="task ${task.done ? 'done' : ''} ${task.due && !task.done && new Date(task.due) < new Date() ? 'overdue' : ''}" onclick="toggleTask('${section}','${key}',${i})">
                                        <input type="checkbox" ${task.done ? 'checked' : ''} 
                                               onclick="event.stopPropagation(); toggleTask('${section}','${key}',${i})">
                                        <span class="task-text">${escapeHtml(task.text)}${task.due ? '<span class="due-date">' + formatDue(task.due) + '</span>' : ''}</span>
                                        <button class="edit" onclick="event.stopPropagation(); editTask('${section}','${key}',${i})">âœŽ</button>
                                        <button class="delete" onclick="event.stopPropagation(); deleteTask('${section}','${key}',${i})">Ã—</button>
                                    </li>
                                `).join('')}
                            </ul>
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width:${pct}%"></div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                updateSectionProgress(section);
            });
            
            updateStats();
        }
        
        function addSubsection(section) {
            const name = prompt('Category name (with emoji if you want):');
            if (!name) return;
            const key = 'cat_' + Date.now();
            data[section][key] = { name, tasks: [] };
            save();
            render();
        }
        
        function addTask(section, key, input) {
            const text = input.value.trim();
            if (!text) return;
            data[section][key].tasks.unshift({ text, done: false, created: Date.now() });
            save();
            render();
            input.value = '';
            input.focus();
        }
        
        function addTaskWithDate(section, key, input) {
            const text = input.value.trim();
            if (!text) return;
            const dateInput = input.parentElement.querySelector('.date-input');
            const task = { text, done: false, created: Date.now() };
            if (dateInput.value) task.due = dateInput.value;
            data[section][key].tasks.unshift(task);
            save();
            render();
            input.value = '';
            dateInput.value = '';
            input.focus();
        }
        
        function toggleTask(section, key, index) {
            data[section][key].tasks[index].done = !data[section][key].tasks[index].done;
            save();
            render();
        }
        
        function deleteTask(section, key, index) {
            data[section][key].tasks.splice(index, 1);
            save();
            render();
        }
        
        function editTask(section, key, index) {
            const task = data[section][key].tasks[index];
            editingTask = { section, key, index };
            document.getElementById('editText').value = task.text;
            document.getElementById('editDate').value = task.due || '';
            document.getElementById('editModal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('editModal').classList.remove('active');
            editingTask = null;
        }
        
        function saveEdit() {
            if (!editingTask) return;
            const { section, key, index } = editingTask;
            const task = data[section][key].tasks[index];
            const newText = document.getElementById('editText').value.trim();
            const newDue = document.getElementById('editDate').value;
            if (newText) task.text = newText;
            if (newDue) task.due = newDue;
            else delete task.due;
            save();
            render();
            closeModal();
        }
        
        // Init
        updateGreeting();
        updateCountdown();
        updateQuote();
        render();
        syncRemoteTasks(); // Fetch tasks from Kuku
        
        setInterval(updateCountdown, 60000);
        setInterval(updateGreeting, 60000);
    </script>
</body>
</html>
